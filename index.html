<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>心跳守護：雲端血壓日誌</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="user-bar">
            <h1>心跳守護</h1>
            <div id="user-info" onclick="resetUser()">👤 載入中...</div>
        </div>
        <div class="date-stepper no-pdf">
            <button onclick="changeDate(-1)">❮</button>
            <div id="target-date-display" class="today-tag">載入中...</div>
            <button onclick="changeDate(1)">❯</button>
        </div>
    </header>

    <main class="container" id="main-report">
        <div class="card-grid no-pdf">
            <div id="morning-card" class="log-card morning" onclick="openModal('morning')">
                <span class="icon">☀️</span>
                <h2>早晨紀錄</h2>
                <p id="morning-status" class="status-label">尚未填寫</p>
            </div>
            <div id="evening-card" class="log-card evening" onclick="openModal('evening')">
                <span class="icon">🌙</span>
                <h2>晚間紀錄</h2>
                <p id="evening-status" class="status-label">尚未填寫</p>
            </div>
        </div>

        <section class="analysis-section">
            <div class="summary-card">
                <div class="summary-header">
                    <h3>📊 數據摘要</h3>
                    <span id="card-date-display"></span>
                </div>
                <p id="avg-text" class="avg-main-text">同步中...</p>
                <div id="sub-avg-text" style="font-size: 0.9rem; color: #777; margin-top: 5px;"></div>
            </div>
            <div class="chart-container"><canvas id="bpChart"></canvas></div>
            <div class="action-buttons no-pdf">
                <button class="btn-pdf-large" onclick="exportPDF()">📄 產出 PDF 報表</button>
                <button class="btn-share-large" onclick="shareToLine()">📤 分享至 LINE</button>
            </div>
        </section>

        <section class="history-section">
            <h3>📋 最近 5 筆紀錄</h3>
            <div id="history-list"></div>
        </section>
    </main>

    <div id="login-modal" class="custom-login-modal">
        <div class="glass-content">
            <div class="modal-icon-wrapper">
                <div class="pulse-ring"></div>
                <span class="modal-icon">🩺</span>
            </div>
            <h2>歡迎使用</h2>
            <p>輸入專屬代號<br>同步您的完整雲端健康日誌</p>
            <div class="input-group">
                <input type="text" id="login-input" placeholder="您的代號 (中/英/數)" autocomplete="off">
            </div>
            <button id="confirm-login-btn" class="primary-btn">開啟雲端同步</button>
        </div>
    </div>

    <div id="log-modal" class="modal">
        <div class="modal-content cute-modal">
            <h3 id="modal-title">紀錄數據</h3>
            <div class="input-field">
                <label>收縮壓 (SYS)</label>
                <input type="number" id="sys" inputmode="numeric" placeholder="120">
            </div>
            <div class="input-field">
                <label>舒張壓 (DIA)</label>
                <input type="number" id="dia" inputmode="numeric" placeholder="80">
            </div>
            <div class="input-field">
                <label>心率 (PUL)</label>
                <input type="number" id="pulse" inputmode="numeric" placeholder="72">
            </div>
            <div class="modal-buttons">
                <button class="btn-save-cute" onclick="saveData()">確認儲存</button>
                <button class="btn-cancel-cute" onclick="closeModal()">取消</button>
            </div>
        </div>
    </div>

    <div id="pdf-wrapper" style="position: absolute; left: -9999px; top: 0; width: 800px;">
        <div id="pdf-template" style="padding: 40px; background: #fff;">
            <h1 style="font-size: 32px; border-bottom: 3px solid #333; padding-bottom: 10px;">血壓健康評估報表</h1>
            <p id="pdf-user-name" style="font-size: 18px; margin: 10px 0;"></p>
            <div id="pdf-avg-main" style="font-size: 24px; font-weight: 900; color: #d63031; margin: 20px 0;"></div>
            <table style="width: 100%; border-collapse: collapse; margin-top:20px;">
                <thead><tr style="background:#f1f1f1;">
                    <th style="border:1px solid #ddd; padding:12px;">日期</th>
                    <th style="border:1px solid #ddd; padding:12px;">時段</th>
                    <th style="border:1px solid #ddd; padding:12px;">血壓</th>
                    <th style="border:1px solid #ddd; padding:12px;">心率</th>
                </tr></thead>
                <tbody id="pdf-table-body"></tbody>
            </table>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>