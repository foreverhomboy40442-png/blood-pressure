<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>心跳守護：雲端血壓日誌</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="user-bar">
            <h1>心跳守護</h1>
            <div id="user-info" onclick="resetUser()" title="點擊切換用戶">👤 載入中...</div>
        </div>
        <div class="date-stepper no-pdf">
            <button onclick="changeDate(-1)">❮</button>
            <div id="target-date-display" class="today-tag">載入中...</div>
            <button onclick="changeDate(1)">❯</button>
        </div>
    </header>

    <main class="container" id="main-report">
        <div class="card-grid no-pdf">
            <div id="morning-card" class="log-card morning" onclick="openModal('morning')">
                <span class="icon">☀️</span>
                <h2>早晨紀錄</h2>
                <p id="morning-status" class="status-label">尚未填寫</p>
            </div>
            <div id="evening-card" class="log-card evening" onclick="openModal('evening')">
                <span class="icon">🌙</span>
                <h2>晚間紀錄</h2>
                <p id="evening-status" class="status-label">尚未填寫</p>
            </div>
        </div>

        <section class="filter-section">
            <div class="filter-buttons no-pdf">
                <button onclick="setRange('today')" id="btn-today">本日</button>
                <button onclick="setRange('week')" id="btn-week" class="active">近一週</button>
                <button onclick="setRange('month')" id="btn-month">近一個月</button>
                <button onclick="toggleCustomRange()" id="btn-custom">自訂查詢</button>
            </div>
            <div id="custom-date-panel" class="custom-date-panel no-pdf">
                <div class="panel-header">選擇查詢範圍</div>
                <div class="date-compact-row">
                    <input type="date" id="start-date" class="small-date-input">
                    <span class="date-sep">至</span>
                    <input type="date" id="end-date" class="small-date-input">
                </div>
                <button class="btn-apply-fancy" onclick="applyCustomRange()">確認查詢</button>
            </div>
        </section>

        <section class="analysis-section">
            <div class="summary-card">
                <div class="summary-header">
                    <h3>📊 數據摘要</h3>
                    <span id="card-date-display"></span>
                </div>
                <p id="avg-text" class="avg-main-text">同步雲端中...</p>
                <div id="sub-avg-text"></div>
                <div id="health-tip" class="health-tip">
                    <div class="tip-title"></div>
                    <div class="tip-content"></div>
                </div>
            </div>
            <div class="chart-container"><canvas id="bpChart"></canvas></div>
            <div class="action-buttons no-pdf">
                <button class="btn-pdf-large" onclick="exportPDF()">📄 產出 PDF 報表</button>
                <button class="btn-share-large" onclick="shareToLine()">📤 分享至 LINE</button>
            </div>
        </section>

        <section class="history-section">
            <h3>📋 最近 5 筆紀錄</h3>
            <div id="history-list"></div>
        </section>
    </main>

    <div id="login-modal" class="custom-login-modal">
        <div class="glass-content">
            <div class="modal-icon-wrapper">
                <div class="pulse-ring"></div>
                <span class="modal-icon">🩺</span>
            </div>
            <h2>歡迎回來</h2>
            <p>請輸入您的專屬代號<br>我們將為您同步完整的健康日誌</p>
            <div class="input-group">
                <input type="text" id="login-input" placeholder="帳號代號 (中/英/數)" autocomplete="off">
            </div>
            <button id="confirm-login-btn" class="primary-btn">開啟雲端同步</button>
            <div class="input-hint">💡 相同代號可在多個裝置找回所有數據</div>
        </div>
    </div>

    <div id="pdf-wrapper" style="visibility: hidden; position: absolute; left: -9999px; top: 0; width: 800px;">
        <div id="pdf-template" style="padding: 40px; background: #fff;">
            <h1 style="font-size: 32px; border-bottom: 3px solid #000; padding-bottom: 10px; margin-bottom: 20px;">血壓健康評估報表</h1>
            <p id="pdf-range" style="font-size: 18px; margin-bottom: 25px; font-weight: bold;"></p>
            <div id="pdf-avg-main" style="font-size: 28px; font-weight: 900; color: #d63031;"></div>
            <table style="width: 100%; border-collapse: collapse; font-size: 18px; margin-top:20px;">
                <thead><tr style="background:#eee;"><th>日期</th><th>時段</th><th>收縮/舒張</th><th>心率</th></tr></thead>
                <tbody id="pdf-table-body"></tbody>
            </table>
        </div>
    </div>

    <div id="log-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title">紀錄數據</h3>
            <div class="input-row"><label>收縮壓 (SYS)</label><input type="number" id="sys" inputmode="numeric"></div>
            <div class="input-row"><label>舒張壓 (DIA)</label><input type="number" id="dia" inputmode="numeric"></div>
            <div class="input-row"><label>心率 (PUL)</label><input type="number" id="pulse" inputmode="numeric"></div>
            <div class="modal-buttons">
                <button class="btn-save" id="btn-save" onclick="saveData()">確認儲存</button>
                <button class="btn-cancel" onclick="closeModal()">取消</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>